<p align="center">
  <img src="public/airplane-flight.svg" alt="АВИАВЭЙС" width="120" height="120" />
</p>

<h1 align="center">АВИАВЭЙС</h1>

---

# Описание проекта

**АВИАВЭЙС** — современная платформа для поиска, бронирования и управления турами и направлениями. Система поддерживает работу с турами, направлениями, отзывами, заказами, а также имеет административную и менеджерскую панели для управления контентом, пользователями и заказами.

---

# Архитектура и структура проекта

```
├── src/
│   ├── app/                # Основные страницы, layout, маршруты, API
│   │   ├── page.tsx        # Главная страница
│   │   ├── layout.tsx      # Глобальный layout, Header, Footer
│   │   ├── api/            # Все серверные API-роуты (REST)
│   │   ├── (protected)/    # Защищённые маршруты (требуют авторизации)
│   │   ├── admin/          # Админ-панель
│   │   ├── manager/        # Панель менеджера
│   │   ├── profile/        # Профиль пользователя
│   │   └── ...
│   ├── components/         # UI-компоненты (карточки, формы, списки, модальные окна)
│   │   ├── admin/          # Компоненты для админки
│   │   ├── auth/           # Компоненты для аутентификации
│   │   └── ...
│   ├── lib/                # Вспомогательные библиотеки (prisma, auth)
│   ├── generated/prisma/   # Сгенерированные Prisma файлы и схема БД
│   └── ...
├── public/                 # Статические файлы, изображения, логотипы
├── prisma/                 # Миграции и seed-скрипты
├── package.json            # Зависимости и скрипты
├── .env                    # Переменные окружения
└── README.md               # Документация
```

---

# Модели данных и связи

## User
- id, name, email, role (USER, ADMIN, MANAGER), phone, address, image
- Связи: All

## Tour
- id, title, slug, price, currency, imageUrl, shortDescription, fullDescription, inclusions, exclusions, itinerary, duration, groupSize, availableSeats, nextTourDate
- Связи: Destination, Review, Order, User

## Destination
- id, name, slug, description, imageUrl
- Связи: Tour

## Review
- id, rating, comment, isApproved, tourId, userId
- Связи: Tour, User

## Order
- id, userId, tourId, quantity, totalPrice, status (PENDING, CONFIRMED, CANCELLED, COMPLETED), contactPhone, contactEmail
- Связи: User, Tour

## Ticket (обращения)
- id, userId, subject, message, status (OPEN, IN_PROGRESS, CLOSED, RESOLVED)
- Связи: User, TicketResponse

## TicketResponse
- id, ticketId, message, isFromStaff
- Связи: Ticket

---

# Роли пользователей и права доступа

- **USER** — поиск и бронирование туров, добавление отзывов, управление своими заказами и обращениями.
- **MANAGER** — управление заказами, тикетами, статистикой, модерация отзывов.
- **ADMIN** — полный доступ: управление турами, направлениями, пользователями, заказами, тикетами, статистикой.

---

# Основные пользовательские функции

- **Главная страница**: поиск туров, фильтрация по направлениям, просмотр популярных туров, быстрый переход к случайному туру.
- **Карточка тура**: подробная информация, отзывы, рейтинг, статус наличия мест, кнопка бронирования.
- **Популярные туры и направления**: отдельные секции для самых востребованных предложений.
- **Отзывы**: просмотр, добавление, модерация (для менеджеров/админов).
- **Профиль пользователя**: история заказов, избранное, обращения в поддержку.
- **Форма поиска**: поиск по названию тура, фильтрация по направлениям.

---

# Административные и менеджерские функции

- **Управление турами**: создание, редактирование, удаление туров через модальные окна с валидацией всех полей.
- **Управление направлениями**: добавление, редактирование, удаление направлений.
- **Управление пользователями**: просмотр, блокировка, изменение ролей.
- **Управление заказами и билетами**: просмотр, изменение статусов, ответы на обращения.
- **Статистика**: просмотр статистики по заказам, турам, направлениям.
- **Модерация отзывов**: одобрение/отклонение отзывов.

---

# Основные компоненты интерфейса

- **Header** — шапка сайта с навигацией, авторизацией, профилем.
- **Footer** — контакты, соцсети, быстрые ссылки, популярные направления.
- **TourCard** — карточка тура с изображением, ценой, направлением, рейтингом, статусом мест.
- **ReviewForm / ReviewList** — формы и списки отзывов.
- **Модальные окна** — для создания/редактирования туров, направлений, пользователей (админка).
- **Форма поиска** — фильтрация туров по названию и направлению.
- **Панели администратора и менеджера** — отдельные разделы для управления контентом и заказами.

---

# API: примеры запросов

## Получить список туров
```http
GET /api/tours?search=пляж&destinationId=2&limit=6&offset=0
```
**Параметры:**
- search — строка поиска по названию
- destinationId — фильтр по направлению
- limit, offset — пагинация
- popular=true — только популярные туры

**Ответ:**
```json
[
  {
    "id": 1,
    "title": "Пляжный отдых в Турции",
    "price": "50000",
    "currency": "RUB",
    "imageUrl": "/images/turkey.jpg",
    "shortDescription": "Лучшие пляжи и отели...",
    "destination": { "name": "Турция" },
    "_count": { "reviews": 12 },
    "averageRating": 4.7
  },
  ...
]
```

## Получить направления
```http
GET /api/destinations?popular=true&limit=5
```

## Оформить заказ
```http
POST /api/orders
Content-Type: application/json
{
  "tourId": 1,
  "quantity": 2,
  "contactPhone": "+79991234567",
  "contactEmail": "user@mail.ru"
}
```

## Оставить отзыв
```http
POST /api/reviews
Content-Type: application/json
{
  "tourId": 1,
  "rating": 5,
  "comment": "Отличный тур!"
}
```

---

# Авторизация и безопасность

- Используется сессии и JWT (NextAuth/собственная реализация).
- Пароли хранятся в хэшированном виде.
- Для защищённых маршрутов и API реализована проверка ролей и прав доступа.
- Все административные и менеджерские действия доступны только авторизованным пользователям с соответствующей ролью.

---

# Развёртывание и настройка

1. Установите зависимости:
   ```bash
   npm install
   ```
2. Настройте переменные окружения в `.env` (см. пример):
   - `DATABASE_URL` — строка подключения к PostgreSQL
   - `NEXTAUTH_SECRET` — секрет для сессий
   - и др.
3. Проведите миграции базы данных:
   ```bash
   npx prisma migrate deploy
   ```
4. (Опционально) Заполните базу тестовыми данными:
   ```bash
   npx prisma db seed
   ```
5. Соберите и запустите проект:
   ```bash
   npm run build && npm start
   ```

---

# Тестирование и CI/CD

- Для тестирования рекомендуется использовать Jest/React Testing Library (добавьте тесты в папку `__tests__`).
- Для проверки стиля кода — ESLint, Prettier.
- Для автоматизации деплоя используйте GitHub Actions или аналогичные CI/CD-системы.

---

# Типовые сценарии использования

- **Пользователь**: ищет тур, фильтрует по направлению, бронирует, оставляет отзыв, отслеживает заказы в профиле.
- **Менеджер**: просматривает новые заказы, отвечает на обращения, модерирует отзывы, анализирует статистику.
- **Администратор**: добавляет новые туры и направления, управляет пользователями, контролирует все процессы.

---

# FAQ

**Q:** Как добавить новый тур?
**A:** Войдите в административную панель, откройте раздел "Туры" и используйте кнопку "Добавить тур". Заполните все поля, добавьте изображения и сохраните.

**Q:** Как добавить новое направление?
**A:** В административной панели перейдите в раздел "Направления" и используйте кнопку "Добавить направление".

**Q:** Как работает фильтрация туров?
**A:** На главной странице используйте форму поиска и выпадающий список направлений. Результаты обновляются автоматически.

**Q:** Как работает система отзывов?
**A:** Пользователь может оставить отзыв к туру. Отзыв проходит модерацию и появляется на странице тура после одобрения.

**Q:** Как восстановить пароль?
**A:** На странице входа используйте ссылку "Забыли пароль?" и следуйте инструкциям.

**Q:** Как изменить роль пользователя?
**A:** Только администратор может изменить роль пользователя через административную панель.

---

# Для разработчиков

- Используется **Next.js** (App Router), **TypeScript**, **Prisma**, **Tailwind CSS**.
- Для запуска в dev-режиме используйте `npm run dev` (не рекомендуется на продакшене).
- Все основные функции и бизнес-логика реализованы в папках `src/app`, `src/components`, `src/app/api`.
- Для расширения функционала добавляйте новые API-роуты в `src/app/api` и компоненты в `src/components`.
- Для работы с БД используйте Prisma Client.
- Для тестирования — Jest, React Testing Library.

---

# Лицензия

Проект создан для учебных и демонстрационных целей.
